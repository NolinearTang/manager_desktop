### **标签系统管理平台 - 设计文档**

---

### 1. 概述

本文档旨在设计一个通用的标签系统管理平台。该平台的核心功能是支持两类不同的标签体系：**实体标签体系**和**意图标签体系**。用户可以通过平台自定义标签的层级结构，并在不同层级上管理具体的数据（实体或规则），最终服务于下游的智能识别和数据分析等业务场景。

### 2. 核心概念

*   **标签体系 (Label System)**: 一个独立的、用于特定目的的标签集合。每个体系都有自己的名称、类型和描述。
    *   **类型**: `ENTITY` (实体) 或 `INTENT` (意图)。
*   **标签/节点 (Label/Node)**: 标签体系中的基本单元，通过父子关系构成一个层级树。例如，“产品类别”是一个标签。
*   **实体 (Entity)**: **实体标签体系**中，挂载在具体标签下的数据项。它代表了现实世界中的具体事物。例如，“汇川”是“品牌”这个标签下的一个实体。
*   **规则 (Rule)**: **意图标签体系**中，挂载在具体标签下的数据项。它定义了识别用户意图的逻辑条件。
*   **表达式 (Expression)**: **规则**的核心组成部分，用于精确匹配。其独特之处在于可以引用**实体标签体系**中的标签或实体，形成强大的组合逻辑。例如 `[品牌:汇川] AND [产品线:伺服]`。

### 3. 功能设计

#### 3.1. 通用标签体系管理

此模块负责对所有标签体系进行宏观管理。

*   **功能列表**:
    1.  **创建标签体系**:
        *   输入体系名称（如：“产品标签体系”、“售后意图体系”）。
        *   选择体系类型（`实体`或`意图`）。
        *   填写体系描述。
    2.  **查看标签体系列表**:
        *   以列表形式展示所有已创建的标签体系。
        *   列表信息包括：名称、类型、描述、创建时间。
    3.  **编辑标签体系**:
        *   修改体系的名称和描述。类型不可修改。
    4.  **删除标签体系**:
        *   提供二次确认，删除后该体系下的所有标签和数据将一并被移除。

#### 3.2. 实体标签体系

此模块专注于实体类标签的管理和构建。

*   **3.2.1. 标签层级树管理**
    *   **界面**: 左侧为可展开/折叠的树状结构。
    *   **功能**:
        1.  **添加标签**:
            *   添加根标签（一级标签）。
            *   在任意标签下添加子标签。
        2.  **重命名标签**: 修改标签的显示名称。
        3.  **删除标签**:
            *   若标签下有子标签，需提示用户是否一并删除。
            *   若标签下有关联的实体，需提示用户风险。
        4.  **拖拽调整层级**: 支持通过拖拽方式调整标签的父子关系和同级顺序。

*   **3.2.2. 实体管理**
    *   **界面**: 右侧为数据表格，展示在左侧树中选中的标签所关联的实体列表。
    *   **功能**:
        1.  **新增实体**:
            *   在一个或多个标签下批量新增实体。
            *   实体属性应包括：
                *   `实体名称` (必填, e.g., "SV660N")
                *   `编码` (可选, e.g., "MODEL-SV660N")
                *   `父级标签` (如果实体需要关联上级实体，e.g., "SV660系列")
                *   `同义词` (e.g., "SV660N伺服")
                *   `状态` (启用/禁用)
        2.  **查看实体**: 点击左侧标签树节点，右侧表格异步加载并显示该标签下的所有实体。
        3.  **编辑实体**: 修改实体的各项属性。
        4.  **删除实体**: 从标签下移除一个实体。

#### 3.3. 意图标签体系

此模块用于定义和管理意图识别的规则。

*   **3.3.1. 意图层级树管理**
    *   与实体标签体系的层级树管理功能完全一致（参考 3.2.1），用于构建意图的分类层级（如：“售前咨询” -> “价格咨询”）。

*   **3.3.2. 规则管理**
    *   **界面**: 右侧为数据表格，展示在左侧意图树中选中的意图所关联的规则列表。
    *   **功能**:
        1.  **新增规则**:
            *   规则属性应包括：
                *   `表达式 (Expression)`: 核心匹配逻辑。
                *   `表达句 (Utterance)`: 用户可能会说的例句 (e.g., "SV660N多少钱一个？")。
                *   `关键词 (Keywords)`: 辅助匹配的词语 (e.g., "价格, 报价, 购买")。
        2.  **表达式构建器 (Expression Builder)**:
            *   这是创建/编辑规则时的核心辅助功能。
            *   提供一个可视化界面，允许用户通过点选方式构建表达式。
            *   **关键功能**: 弹出一个选择器，该选择器可以列出所有**实体标签体系**中的标签和实体。
            *   用户可以选择一个实体（如 `品牌:汇川`），并将其插入到表达式输入框中，形成 `[品牌:汇川]` 这样的结构。
            *   支持 `AND`, `OR`, `NOT` 等逻辑运算符组合多个实体/标签条件。
        3.  **查看/编辑/删除规则**: 与实体管理类似的标准CRUD操作。

### 4. 数据模型设计 (Database Schema)

为了支撑上述功能，建议设计以下核心数据表：

1.  **`label_systems` (标签体系表)**
    *   `id`: 主键, INT
    *   `name`: 体系名称, VARCHAR(255)
    *   `type`: 体系类型, ENUM('ENTITY', 'INTENT')
    *   `description`: 描述, TEXT
    *   `created_at`: 创建时间, DATETIME

2.  **`labels` (标签/节点表)**
    *   `id`: 主键, INT
    *   `system_id`: 外键, 关联 `label_systems.id`
    *   `parent_id`: 父节点ID, INT (自关联，根节点为 NULL)
    *   `name`: 标签名称, VARCHAR(255)
    *   `level`: 层级深度, INT
    *   `sort_order`: 排序, INT

3.  **`entities` (实体表)**
    *   `id`: 主键, INT
    *   `label_id`: 外键, 关联 `labels.id`
    *   `name`: 实体名称, VARCHAR(255)
    *   `code`: 编码, VARCHAR(100)
    *   `parent_entity_id`: 父实体ID, INT (用于实体间的父子关系)
    *   `status`: 状态, ENUM('ENABLED', 'DISABLED')

4.  **`entity_synonyms` (实体同义词表)**
    *   `id`: 主键, INT
    *   `entity_id`: 外键, 关联 `entities.id`
    *   `synonym`: 同义词, VARCHAR(255)

5.  **`rules` (规则表)**
    *   `id`: 主键, INT
    *   `label_id`: 外键, 关联 `labels.id` (意图标签)
    *   `expression`: 表达式, TEXT
    *   `utterance`: 表达句, TEXT
    *   `keywords`: 关键词, TEXT

### 5. API 设计 (高阶)

建议采用 RESTful 风格设计 API 接口。

*   **标签体系**:
    *   `GET /api/label-systems`
    *   `POST /api/label-systems`
    *   `GET /api/label-systems/{id}`
    *   `PUT /api/label-systems/{id}`
    *   `DELETE /api/label-systems/{id}`

*   **标签层级**:
    *   `GET /api/label-systems/{system_id}/labels` (获取整个树)
    *   `POST /api/labels` (创建新标签)
    *   `PUT /api/labels/{id}` (修改/移动标签)
    *   `DELETE /api/labels/{id}`

*   **实体**:
    *   `GET /api/labels/{label_id}/entities`
    *   `POST /api/entities`
    *   `PUT /api/entities/{id}`
    *   `DELETE /api/entities/{id}`

*   **规则**:
    *   `GET /api/labels/{label_id}/rules`
    *   `POST /api/rules`
    *   `PUT /api/rules/{id}`
    *   `DELETE /api/rules/{id}`

### 6. 技术选型建议

*   **后端**: Python + FastAPI (与当前项目保持一致)，SQLAlchemy (ORM)，Pydantic (数据校验)。
*   **前端**: HTML + Tailwind CSS + Vanilla JavaScript (与当前项目保持一致)，可引入轻量级工具库如 `Choices.js` (下拉选择)、`SortableJS` (拖拽排序) 来提升用户体验。
*   **数据库**: MySQL 或 PostgreSQL。

---
